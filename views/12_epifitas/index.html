{{extend 'layout.html'}}
{{block head}}
<style type="text/css">

    .Tabla .string
    {
        margin-right: 0.5cm;
        width: 2cm;
        text-align: center;
    }
    
    .Tabla .generic-widget
    {
    	margin-right: 2cm;
        width: 4.4cm;
    }
    
    .FlotaIzquierda
    {
        float: left;
    }

    .Centrar
    {
        text-align: center;
    }

</style>
{{end}}
{{#=response.toolbar()}}

<form action="" enctype="multipart/form-data" method="post">
    <input type="hidden" name="_formname" value="formaEpifitasHTML"/>
    <fieldset>
        <legend>
            Información de epífitas
        </legend>
        <table class="Tabla">
            <tr>
                <td>
                    <div>
                        <label for="tabla_conglomerado_muestra_id">Conglomerado</label>
                    </div>
                    <div>
                        <select class="generic-widget obligatorio" name="conglomerado_muestra_id" id="tabla_conglomerado_muestra_id">
                            <option value=""/>
                            {{for conglomerado in listaConglomerado:}}
                                <option value="{{=conglomerado.id}}">
                                    {{=conglomerado.nombre}}
                                </option>
                            {{pass}}
                        </select>
                    </div>
                </td>                
            </tr>
        </table>
        <hr/>
        <table>
            <tr>
                <th>Tipo</th>
                <th>Evidencia</th>
            </tr>
            <tr>
                <td>
                    <label for="tabla_helechos_observados">Helechos</label>
                </td>
                <td class="Centrar">
                    <input class="boolean" name="helechos_observados" id="tabla_helechos_observados" type="checkbox" value="on"/>
                </td>
            </tr>
            <tr>
                <td>
                    <label for="tabla_orquideas_observadas">Orquídeas</label>
                </td>
                <td class="Centrar">
                    <input class="boolean" name="orquideas_observadas" id="tabla_orquideas_observadas" type="checkbox" value="on"/>
                </td>
            </tr>
            <tr>
                <td>
                    <label for="tabla_musgos_observados">Musgos</label>
                </td>
                <td class="Centrar">
                    <input class="boolean" name="musgos_observados" id="tabla_musgos_observados" type="checkbox" value="on"/>
                </td>
            </tr>
            <tr>
                <td>
                    <label for="tabla_liquenes_observados">Líquenes</label>
                </td>
                <td class="Centrar">
                    <input class="boolean" name="liquenes_observados" id="tabla_liquenes_observados" type="checkbox" value="on"/>
                </td>
            </tr>
            <tr>
                <td>
                    <label for="tabla_cactaceas_observadas">Cactáceas</label>
                </td>
                <td class="Centrar">
                    <input class="boolean" name="cactaceas_observadas" id="tabla_cactaceas_observadas" type="checkbox" value="on"/>
                </td>
            </tr>
            <tr>
                <td>
                    <label for="tabla_bromeliaceas_observadas">Bromeliáceas</label>
                </td>
                <td class="Centrar">
                    <input class="boolean" name="bromeliaceas_observadas" id="tabla_bromeliaceas_observadas" type="checkbox" value="on"/>
                </td>
            </tr>
            <tr>
                <td>
                    <label for="tabla_otras_observadas">Otras</label>
                </td>
                <td class="Centrar">
                    <input class="boolean" name="otras_observadas" id="tabla_otras_observadas" type="checkbox" value="on"/>
                </td>
                <td>
                    <div class="Nombre">
                        <label for="tabla_nombre_otras">Nombre</label>
                    </div>
                </td>
                <td>
                    <div class="Nombre">
                        <input class="string" name="nombre_otras" id="tabla_nombre_otras" type="text" value=""/>
                    </div>
                </td>
            </tr>
        </table>
    <hr/>
    </fieldset>
    <input type="submit" value="Enviar" class="btn FlotaIzquierda"/>
</form>

{{#=BEAUTIFY(request.vars)}}
<script>

    $(document).ready
    (
        function()
        {
           /* Cuando el documento se carga, el campo Nombre está escondido */
           $('#tabla_otras_observadas').prop('checked', false);
           $('.Nombre').hide();
        }
    )
    
    /* Cuando se selecciona la opción "Otras" aparece el campo Nombre */
    
    $('#tabla_otras_observadas').change
    (
        function()
        {
            if($(this).prop('checked'))
            {
                $('.Nombre').fadeIn();
            }
            else
                $('.Nombre').fadeOut();
        }
    )

    //AJAX para evitar que se envíe la información de epífitas correspondiente
    //a un conglomerado más de una vez:
    $('#tabla_conglomerado_muestra_id').change(function (){
        $.ajax
        (
        {
            type: "POST",
            data: $('#tabla_conglomerado_muestra_id').serialize(),
            url: "{{=URL('informacionEpifitasExistente')}}",
            success: function(resultado)
                {
                    //alert(resultado);
                    if(resultado>0)
                    {
                        alert('La información de epífitas ya ha sido insertada para el conglomerado seleccionado');
                        $('#tabla_conglomerado_muestra_id').val("");
                    }
                }
            }
            );
        }
        );

    //Validando, para ello utilizamos la clase "obligatorio":
    $('form').submit
    (
         function()
         {
            flag =true;
            campos=$('.obligatorio');
            campos.each(function() 
            {
                if(!$(this).val())
                {
                    flag = false;
                }
            }
            );

            //Validando que se escriba el nombre de la epífita si la opción "Otras"
            // es seleccionada

            faltanNombres = false;
            if($('#tabla_otras_observadas').prop('checked'))
            {
                if(!$(tabla_nombre_otras).val())
                {
                    //alert('Favor de introducir el nombre de las epífitas observadas');
                    flag=false;
                    faltanNombres=true;
                }
            }

            if(!flag)
            {
                if(faltanNombres)
                    alert('Favor de escribir el nombre de la epífita que no se encuentra en la lista');
                else
                    alert('Faltó llenar algún campo');
                return false;
            }

        }
    )
    
</script>
