{{extend 'layout.html'}} 
{{block head}}
<style type="text/css">

    .No_GPS .double, .No_GPS .date, .No_GPS .string, .No_GPS .time
    {
        margin-right: 2cm;
        width: 4cm;
    }
    
    .No_GPS .generic-widget
    {
        margin-right: 2cm;
        width: 4.4cm;
    }

    .GPS .integer, .GPS .double
    {
        width: 2cm;
    }
    
    .GPS .generic-widget
    {
        width: 2.5cm;
    }

    .Centrar
    {
        text-align: center;
    }

    .CentrarV
    {
        vertical-align:middle;
    }
   
    .FlotaIzquierda
    {
        float: left;
    }

    #campoEspecial
    {
      padding-top: 10px;
      padding-bottom: 10px;
    }

</style>
{{end}}

<form action="#" enctype="multipart/form-data" method="post">
  <input type="hidden"  name="_formname" value="formaHuellaExcretaHTML"/>
  <fieldset>
    <legend>
    Registros adicionales: huellas y excretas
    </legend>
    <table class="No_GPS">
      <tr>
        <td rowspan="2" class="CentrarV">
          <div>
            <label for="tabla_conglomerado_muestra_id">Conglomerado</label>
          </div>
          <div>
            <select class="generic-widget obligatorio" name="conglomerado_muestra_id" id="tabla_conglomerado_muestra_id">
              <option value=""/>
              {{for conglomerado in listaConglomerado:}}
                <option value="{{=conglomerado.id}}">
                  {{=conglomerado.nombre}}
                </option>
              {{pass}}
            </select>
          </div>
        </td>
        <td>
          <div class="FlotaIzquierda" style="padding-right:10px;">
            <label for="tabla_dentro_conglomerado">Dentro del conglomerado</label>
          </div>
          <div>
            <input class="boolean" name="dentro_fuera_conglomerado" id="tabla_dentro_conglomerado" type="radio" value="dentro"/>
          </div>
        </td>
        <td rowspan="2" class="CentrarV">
          <div>
            <label for="tabla_tecnico">Técnico</label>
          </div>
          <div>
            <input class="string obligatorio" name="tecnico" id="tabla_tecnico" type="text" value=""/>
          </div>
        </td>
      </tr>
      <tr>
        <td>
          <div class="FlotaIzquierda" style="padding-right:17px">
            <label for="tabla_fuera_conglomerado">Fuera del conglomerado</label>
          </div>
          <div>
            <input class="boolean" name="dentro_fuera_conglomerado" id="tabla_fuera_conglomerado" type="radio" value="fuera"/>
          </div>
        </td>
      </tr> 
      <tr>
        <td>
          <div>
            <label for="tabla_fecha">Fecha</label>
          </div>
          <div>
            <input class="date obligatorio" name="fecha" id="tabla_fecha" type="text" value=""/>
          </div>
        </td>
        <td>
          <div>
            <label for="tabla_hora">Hora</label>
          </div>
          <div>
            <input class="time obligatorio" name="hora" id="tabla_hora" type="text" value=""/>
          </div>
        </td>
        <td>
        </td>
      </tr>
    </table>

        <hr/>

      <table class="GPS">
        <tr>
          <th colspan="3", class="Centrar">
                  Latitud
              </th>
              <th colspan="3", class="Centrar">
                  Longitud
              </th>
              <th>
              </th>
              <th>
              </th>
              <th>
              </th>
            </tr>
            <tr>
              <th class="Centrar">
                <label for="lat_grado">Grado</label>
              </th>
              <th class="Centrar">
                <label for="lat_min">Minuto</label>
              </th>
              <th class="Centrar">
                <label for="lat_seg">Segundo</label>
              </th>
              <th class="Centrar">
                <label for="lon_grado">Grado</label>
              </th>
              <th class="Centrar">
              <label for="lon_min">Minuto</label>
              </th>
              <th class="Centrar">
                <label for="lon_seg">Segundo</label>
              </th>
              <th class="Centrar">                  
                <label for="tabla_elipsoide">Datum</label>
              </th>
              <th class="Centrar">
                <label for="tabla_altitud">Altitud(m)</label>
              </th>
              <th class="Centrar">
                <label for="tabla_gps_error">Error(m)</label>
              </th>
            </tr>

            <tr>
              <td>
                <input class="integer obligatorio" name="lat_grado" id="tabla_lat_grado" type="text"/>
              </td>
              <td>
                <input class="integer obligatorio" name="lat_min" id="tabla_lat_min" type="text"/>
              </td>
              <td>
                <input class="double obligatorio" name="lat_seg" id="tabla_lat_seg" type="text"/>
              </td>
              <td>
                <input class="integer obligatorio" name="lon_grado" id="tabla_lon_grado" type="text"/>
              </td>
              <td>
              <input class="integer obligatorio" name="lon_min" id="tabla_lon_min" type="text"/>
              </td>
              <td>
                <input class="double obligatorio" name="lon_seg" id="tabla_lon_seg" type="text"/>
              </td>
              <td>
              <select class="generic-widget obligatorio" name="elipsoide" id="tabla_elipsoide">
            <option value=""/>
            {{for elipsoide in listaElipsoide:}}
              <option value="{{=elipsoide.id}}">
                {{=elipsoide.nombre}}
              </option>
            {{pass}}
          </select>
              </td>
              <td>
                <input class="double obligatorio" name="altitud" id="tabla_altitud" type="text" value=""/>
              </td>
              <td>
                  <input class="double obligatorio" name="gps_error" id="tabla_gps_error" type="text" value=""/>
              </td>
            </tr>
    </table>

      <hr/>

    <table class="No_GPS">
      <tr>
        <td id="campoEspecial" colspan="2">
          <div class="FlotaIzquierda" style="padding-right:10px;">
            <label for="tabla_es_huella">Huella</label>
          </div>
          <div class="FlotaIzquierda" style="padding-right:30px;">
            <input class="boolean" name="es_huella_excreta" id="tabla_es_huella" type="radio" value="huella"/>
          </div>
          <div class="FlotaIzquierda" style="padding-right:10px;">
            <label for="tabla_es_excreta">Excreta</label>
          </div>
          <div class="FlotaIzquierda">
            <input class="boolean" name="es_huella_excreta" id="tabla_es_excreta" type="radio" value="excreta"/>
          </div>
        </td>
      </tr>
      <tr>
        <td colspan="2">
          <div class="FlotaIzquierda" style="padding-right:10px;">
            <input class="boolean" name="hay_nombre_comun" id="tabla_hay_nombre_comun" type="checkbox" value="on"/>
          </div>
          <div class="FlotaIzquierda" style="padding-right:22px;">
            <label for="tabla_nombre_comun">Nombre común</label>
          </div>
          <div class="FlotaIzquierda">
            <input class="string" name="nombre_comun" id="tabla_nombre_comun" type="text" value=""/>
          </div>
        </td>
      </tr>
      <tr>
        <td colspan="2">
          <div class="FlotaIzquierda" style="padding-right:10px;">
            <input class="boolean" name="hay_nombre_cientifico" id="tabla_hay_nombre_cientifico" type="checkbox" value="on"/>
          </div>
          <div class="FlotaIzquierda" style="padding-right:10px;">
            <label for="tabla_nombre_cientifico">Nombre científico</label>
          </div>
          <div class="FlotaIzquierda">
            <input class="string" name="nombre_cientifico" id="tabla_nombre_cientifico" type="text" value=""/>
          </div>
        </td>
      </tr>
      <tr>
        <td>
          <div>
            <label for="tabla_largo">Largo(cm)</label>
          </div>
          <div>
            <input class="double obligatorio" name="largo" id="tabla_largo" type="text" value=""/>
          </div>
        </td>
        <td>
          <div>
            <label for="tabla_ancho">Ancho(cm)</label>
          </div>
          <div>
            <input class="double obligatorio" name="ancho" id="tabla_ancho" type="text" value=""/>
          </div>
        </td>
      </tr>
    </table>
  </fieldset>
  <fieldset>
    <legend>
      Subir archivos
    </legend>
    <div id="campoEspecial">
      <input type="file" class="obligatorio" id="tabla_archivos_huella_excreta_extra" name="archivos_huella_excreta_extra" multiple/>
    </div>  
  </fieldset>

  <br/>
  <fieldset>
    <legend>
    Observaciones
    </legend>
      <div>
        <textarea class="text" cols="40" id="tabla_comentario" name="comentario" rows="5"></textarea>
      </div>    
  </fieldset>
  <input type="submit" value="Enviar" class="btn FlotaIzquierda"/>
</form>

<script>

  $(document).ready
    (
        function()
        {
           /*Cuando el documento se carga, las casillas para seleccionar nombres
           están seleccionadas y los campos de texto son visibles (default):*/
            $('#tabla_hay_nombre_comun').prop('checked', true);

      $('#tabla_hay_nombre_cientifico').prop('checked', true);
        }
    )

    /*Fade in/out de los campos de ingreso de nombre común/científico, de acuerdo
    a si se marcó o no la casilla correspondiente*/

    $('#tabla_hay_nombre_comun').change
    (
        function()
        {
            if($(this).prop('checked'))
                $('#tabla_nombre_comun').fadeIn();
            else
                $('#tabla_nombre_comun').fadeOut();
        }
    )

    $('#tabla_hay_nombre_cientifico').change
    (
        function()
        {
            if($(this).prop('checked'))
                $('#tabla_nombre_cientifico').fadeIn();
            else
                $('#tabla_nombre_cientifico').fadeOut();
        }
    )

    //Validando, para ello utilizamos la clase "obligatorio":
    $('form').submit
    (
      function()
      {
        /*flag es un indicador de que la forma está completa
        faltanNombres es un indicador de que es necesario que se escriban
        ya sea el nombre común o el científico de la especia (ésto es cuando
        la especie no se encuentra en la lista de invasoras), y sin embargo,
        no se ha hecho.*/
        flag = true;
        faltanNombres = false;

        campos=$('.obligatorio');
        campos.each(function() 
        {
          if(!$(this).val())
          {
             flag = false;
          }
      }
      );

      //Validando los radio-botones "dentro_fuera_conglomerado"
      if(!$('input:radio[name=dentro_fuera_conglomerado]:checked').val())
      {
        flag = false;
        //alert('falta presionar un radio-botón');
      }


      //Validando los radio-botones "es_huella_excreta"
      if(!$('input:radio[name=es_huella_excreta]:checked').val())
      {
        flag = false;
        //alert('falta presionar un radio-botón');
      }

        //Si no se marcó ninguna casilla para ingresar el nombre
        if(!$('#tabla_hay_nombre_comun').prop('checked') && !$('#tabla_hay_nombre_cientifico').prop('checked'))
        {
          flag = false;
          faltanNombres = true;
          //alert('caso1');
        }
        else if($('#tabla_hay_nombre_comun').prop('checked') && !$('#tabla_nombre_comun').val())
        /*Si se marcó la casilla de nombre común pero no se escribió
        nada en el campo subsecuente.*/
        {
          flag = false;
          faltanNombres = true;
          //alert('caso2');
        }
         //Si se marcó la casilla de nombre científico pero no se escribió nada en el campo subsecuente.
        else if($('#tabla_hay_nombre_cientifico').prop('checked') && !$('#tabla_nombre_cientifico').val())
        {
          flag = false;
          faltanNombres = true;
          //alert('caso3');
        }

        if(!flag)
          {
              if(faltanNombres)
                alert('Favor de escribir al menos un nombre (ya sea común científico)');
              else
                alert('Faltó llenar un campo o subir alguna imagen.');

              return false;
      }
      }
    )
</script>
